# 多语言支持实施计划（中 / 日 / 韩 / 英）

## 目标
- 为应用提供完整的多语言界面支持：`zh-CN`、`en-US`、`ja-JP`、`ko-KR`。
- 让“界面语言”与“对话语言提示”可联动，但职责分离：
  - UI 文案由前端 i18n 管理。
  - LLM 输出语言由系统提示中的语言块控制。
- 确保语言切换后即时生效、可持久化、可回退。

## 需求范围
- 包含窗口：
  - 配置窗口（全部标签页）
  - 对话窗口
  - 归档窗口
  - 弹窗（历史、记忆、预览、错误、状态提示）
- 包含内容：
  - 静态文案（按钮、标签、说明）
  - 动态文案模板（带参数插值）
  - 时间/数字本地化显示
  - 系统提示词中的语言设定块

## 不在本期范围
- 不做自动机器翻译服务接入。
- 不做按用户区域自动识别（默认先用 `zh-CN`）。
- 不调整业务逻辑，仅改文案与语言相关显示逻辑。

## 技术方案
1. 前端 i18n 框架
- 使用 `vue-i18n`。
- 统一调用 `t('key')`，禁止新增硬编码 UI 文案。

2. 语言资源格式
- 使用 JSON 文件，路径：
  - `src/locales/zh-CN.json`
  - `src/locales/en-US.json`
  - `src/locales/ja-JP.json`
  - `src/locales/ko-KR.json`
- Key 命名规则：英文语义路径（如 `config.hotkey.label`）。
- 四份语言文件必须 key 完全一致。

3. 配置持久化
- 在配置中新增字段：`uiLanguage`（默认 `zh-CN`）。
- 启动读取配置并初始化 locale。
- 切换语言后立即保存配置并广播到各窗口。

4. 时间/数字本地化
- 统一使用 `Intl.DateTimeFormat(locale)`、`Intl.NumberFormat(locale)`。
- 避免手写日期字符串拼接。

5. 提示词联动
- 新增语言映射表（例如：`zh-CN -> 请使用中文回答`）。
- 在系统提示组装阶段注入语言设定块（放在固定位置，便于后续维护）。

## 分阶段执行

### 阶段 A：基础设施
- [ ] 安装并初始化 `vue-i18n`。
- [ ] 创建四套语言 JSON 骨架及类型约束。
- [ ] 在应用入口挂载 i18n。
- [ ] 增加 `uiLanguage` 配置读写。

### 阶段 B：配置窗口国际化
- [ ] 替换配置页全部静态文案为 i18n key。
- [ ] 状态消息与错误消息改为模板化翻译。
- [ ] 新增“界面语言”下拉并实时切换。

### 阶段 C：对话与归档窗口国际化
- [ ] 对话页按钮、占位符、状态文案国际化。
- [ ] 归档页按钮、标题、提示文案国际化。
- [ ] 各类 dialog 文案国际化。

### 阶段 D：系统提示词语言联动
- [ ] 将语言设定抽为可配置映射。
- [ ] 按当前语言注入对话语言指令。
- [ ] 确认不影响现有记忆/工具/归档注入顺序。

### 阶段 E：验收与防回归
- [ ] 四语言逐页走查（配置/对话/归档）。
- [ ] 切换语言后重启验证持久化。
- [ ] 关键流程冒烟：发消息、工具调用、归档导出、提示词预览。
- [ ] 增加基础单测/快照校验（至少校验 key 完整性）。

## 验收标准
- 切换语言后 UI 文案即时变化，无需重启。
- 重启后语言保持上次选择。
- 四语言下主要页面无未翻译 key 泄露（如 `config.xxx` 原样显示）。
- 系统提示词语言指令与 UI 当前语言一致。
- 不引入现有功能回归（发送、归档、导出、工具状态）。

## 风险与约束
- 历史代码硬编码文案较多，分批替换时可能出现漏网 key。
- 多窗口同步需要统一事件机制，避免一个窗口已切换、另一个未刷新。
- 部分提示文本来自后端，需确定由前端翻译还是后端多语言返回（本期优先前端翻译）。

## 实施备注
- 本计划为“全量完成后统一验收”模式，中途不要求你逐步手测。
- 开发过程中每阶段独立提交，便于回滚与定位问题。
